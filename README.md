# Luckfox Pico V4L2 æ‘„åƒå¤´é«˜æ€§èƒ½é‡‡é›†ä¸ç½‘ç»œæ¨æµç³»ç»Ÿ

ä¸€ä¸ªä¸“ä¸º **Luckfox Pico Mini B + SC3336 RAW10 æ‘„åƒå¤´** è®¾è®¡çš„é«˜æ€§èƒ½è§†é¢‘é‡‡é›†ä¸ç½‘ç»œæ¨æµç³»ç»Ÿï¼Œæ”¯æŒ 2048Ã—1296 åˆ†è¾¨ç‡å®æ—¶é‡‡é›†ï¼Œå¹¶é€šè¿‡ç½‘ç»œæ¨æµè‡³ PC ç«¯è¿›è¡Œå¤„ç†ã€‚

## ğŸ¯ é¡¹ç›®ç‰¹è‰²

- **é«˜åˆ†è¾¨ç‡æ”¯æŒ**: 2048Ã—1296 RAW10 æ ¼å¼ï¼Œä¸“ä¸šçº§å›¾åƒè´¨é‡
- **é«˜æ€§èƒ½ä¼ è¾“**: åŸºäºå¤šå¹³é¢ V4L2 APIï¼Œä¼˜åŒ–å†…å­˜å¯¹é½ä¸ç¼“å†²åŒºç®¡ç†
- **è·¨å¹³å°å…¼å®¹**: æ”¯æŒ Linux x86_64ã€Windows å¹³å°
- **ç½‘ç»œæ¨æµ**: TCP å®æ—¶æ¨æµï¼Œæ”¯æŒå¤šå®¢æˆ·ç«¯è¿æ¥
- **é›¶ä¸´æ—¶æ–‡ä»¶**: çº¯å†…å­˜ä¼ è¾“ï¼Œé¿å…å­˜å‚¨ç©ºé—´é™åˆ¶
- **ä¼˜é›…é€€å‡º**: å®Œå–„çš„ä¿¡å·å¤„ç†ï¼Œæ”¯æŒ Ctrl+C æ­£å¸¸é€€å‡º

## ğŸ“ é¡¹ç›®ç»“æ„

```
v4l2_bench/
â”œâ”€â”€ source_linux_armv7l/          # åµŒå…¥å¼ ARM å¹³å°æºç 
â”‚   â”œâ”€â”€ v4l2_usb.c                 # ğŸ”¥ ç½‘ç»œæ¨æµæœåŠ¡å™¨ (åµŒå…¥å¼ç«¯)
â”‚   â”œâ”€â”€ v4l2_bench_mp.c            # å¤šå¹³é¢æ ¼å¼åŸºå‡†æµ‹è¯•
â”‚   â””â”€â”€ test_multiplanar.c         # å¤šå¹³é¢ API éªŒè¯ç¨‹åº
â”œâ”€â”€ source_linux_x86_64/          # Linux PC å¹³å°æºç 
â”‚   â””â”€â”€ v4l2_usb_pc.c              # ç½‘ç»œæ¥æ”¶å®¢æˆ·ç«¯ (Linux PC)
â”œâ”€â”€ source_win_x86_64/            # Windows å¹³å°æºç 
â”‚   â”œâ”€â”€ v4l2_usb_pc_win.c          # ç½‘ç»œæ¥æ”¶å®¢æˆ·ç«¯ (Windows PC)
â”‚   â””â”€â”€ build_windows.bat          # Windows ä¸€é”®ç¼–è¯‘è„šæœ¬
â”œâ”€â”€ CMakeLists.txt                 # CMake æ„å»ºé…ç½®
â”œâ”€â”€ build.sh                       # ä¸€é”®ç¼–è¯‘è„šæœ¬
â””â”€â”€ README.md                      # ğŸ“– æœ¬æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ç½‘ç»œæ¨æµ     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Luckfox Pico  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚   PC å®¢æˆ·ç«¯      â”‚
â”‚                 â”‚   TCP:8888    â”‚                 â”‚
â”‚ â€¢ v4l2_usb      â”‚               â”‚ â€¢ v4l2_usb_pc   â”‚
â”‚ â€¢ SC3336 æ‘„åƒå¤´ â”‚               â”‚ â€¢ å¸§æ•°æ®ä¿å­˜     â”‚
â”‚ â€¢ 172.32.0.93   â”‚               â”‚ â€¢ å®æ—¶æ˜¾ç¤º       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ç½‘ç»œé…ç½®

| è®¾å¤‡ | IP åœ°å€ | ç«¯å£ | è§’è‰² |
|------|---------|------|------|
| **Luckfox Pico** | `172.32.0.93` | `8888` | æœåŠ¡å™¨ (æ¨æµç«¯) |
| **PC å®¢æˆ·ç«¯** | åŒç½‘æ®µä»»æ„IP | - | å®¢æˆ·ç«¯ (æ¥æ”¶ç«¯) |

> **âš ï¸ é‡è¦**: ç¡®ä¿ PC å’Œ Luckfox Pico åœ¨åŒä¸€ç½‘ç»œæ®µï¼Œå»ºè®®ä½¿ç”¨åƒå…†ä»¥å¤ªç½‘ã€‚

### 3. ç¼–è¯‘ç¨‹åº

#### ğŸ”§ åµŒå…¥å¼ç«¯ (äº¤å‰ç¼–è¯‘)

```bash
# æ–¹å¼1: ä½¿ç”¨ CMake (æ¨è)
cd v4l2_bench
mkdir -p build && cd build
cmake ..
make

# æ–¹å¼2: ä½¿ç”¨ä¸€é”®è„šæœ¬
./build.sh

# ç¼–è¯‘ç»“æœ:
# build/v4l2_usb          - ç½‘ç»œæ¨æµæœåŠ¡å™¨
# build/v4l2_bench_mp     - åŸºå‡†æµ‹è¯•ç¨‹åº
# build/test_multiplanar  - å¤šå¹³é¢éªŒè¯ç¨‹åº
```

#### ğŸ–¥ï¸ Linux PC ç«¯

```bash
cd source_linux_x86_64
make
# ç”Ÿæˆ: v4l2_usb_pc
```

#### ğŸªŸ Windows PC ç«¯

```cmd
cd source_win_x86_64
build_windows.bat
# ç”Ÿæˆ: v4l2_usb_pc.exe
```

æˆ–æ‰‹åŠ¨ç¼–è¯‘ï¼š
```cmd
gcc -o v4l2_usb_pc.exe v4l2_usb_pc_win.c -lws2_32
```

### 4. éƒ¨ç½²ä¸è¿è¡Œ

#### ğŸ“¤ éƒ¨ç½²åˆ° Luckfox Pico

```bash
# ä¸Šä¼ ç¨‹åºåˆ°è®¾å¤‡
scp build/v4l2_usb build/v4l2_bench_mp root@172.32.0.93:/root/
```

#### ğŸ¬ å¯åŠ¨ç³»ç»Ÿ

**æ­¥éª¤1: åœ¨ Luckfox Pico ä¸Šå¯åŠ¨æœåŠ¡å™¨**
```bash
# SSH ç™»å½•åˆ° Luckfox Pico
ssh root@172.32.0.93

# å¯é€‰: å…ˆæµ‹è¯•æ‘„åƒå¤´å·¥ä½œçŠ¶æ€
./v4l2_bench_mp

# å¯åŠ¨ç½‘ç»œæ¨æµæœåŠ¡å™¨
./v4l2_usb
# æˆ–æŒ‡å®šç«¯å£: ./v4l2_usb 8888
```

**æ­¥éª¤2: åœ¨ PC ä¸Šå¯åŠ¨å®¢æˆ·ç«¯**

Linux:
```bash
./v4l2_usb_pc
# æˆ–è‡ªå®šä¹‰å‚æ•°: ./v4l2_usb_pc -s 172.32.0.93 -p 8888 -o ./saved_frames
```

Windows:
```cmd
v4l2_usb_pc.exe
# æˆ–è‡ªå®šä¹‰å‚æ•°: v4l2_usb_pc.exe -s 172.32.0.93 -p 8888 -o ./saved_frames
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| å‚æ•° | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| **åˆ†è¾¨ç‡** | 2048Ã—1296 | SC3336 æ‘„åƒå¤´æœ€å¤§åˆ†è¾¨ç‡ |
| **æ ¼å¼** | RAW10 (SBGGR10) | 10ä½åŸå§‹æ‹œè€³æ ¼å¼ |
| **å¸§ç‡** | ~30 FPS | å®é™…å¸§ç‡å–å†³äºç½‘ç»œå¸¦å®½ |
| **æ•°æ®é‡** | ~5.3MB/å¸§ | 2048Ã—1296Ã—10bit/8 + 256å­—èŠ‚å¯¹é½ |
| **ç½‘ç»œå¸¦å®½** | ~100MB/s | å»ºè®®åƒå…†ä»¥å¤ªç½‘ |
| **å†…å­˜å ç”¨** | <50MB | 3ä¸ªç¼“å†²åŒº + ç½‘ç»œç¼“å­˜ |

## ğŸ› ï¸ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: åŸºæœ¬å®æ—¶æ¨æµ
```bash
# Luckfox Pico
./v4l2_usb

# PC (æ¥æ”¶å¹¶ä¿å­˜åˆ°å½“å‰ç›®å½•)
./v4l2_usb_pc
```

### åœºæ™¯2: æŒ‡å®šä¿å­˜ç›®å½•
```bash
# PC
./v4l2_usb_pc -o /path/to/save/frames
```

### åœºæ™¯3: è‡ªå®šä¹‰ç½‘ç»œé…ç½®
```bash
# å¦‚æœ Luckfox Pico ä½¿ç”¨ä¸åŒ IP
./v4l2_usb_pc -s 192.168.1.100 -p 8888
```

### åœºæ™¯4: å¤šå®¢æˆ·ç«¯æ¥æ”¶
```bash
# å¯åŒæ—¶å¯åŠ¨å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥åŒä¸€æœåŠ¡å™¨
./v4l2_usb_pc -o ./client1_frames &
./v4l2_usb_pc -o ./client2_frames &
```

## ğŸ”§ å‘½ä»¤è¡Œå‚æ•°

### v4l2_usb (æœåŠ¡å™¨ç«¯)
```bash
./v4l2_usb [port]
```
- `port`: ç›‘å¬ç«¯å£ (é»˜è®¤: 8888)

### v4l2_usb_pc (å®¢æˆ·ç«¯)
```bash
./v4l2_usb_pc [-s server_ip] [-p port] [-o output_dir]
```
- `-s server_ip`: æœåŠ¡å™¨IPåœ°å€ (é»˜è®¤: 172.32.0.93)
- `-p port`: æœåŠ¡å™¨ç«¯å£ (é»˜è®¤: 8888)
- `-o output_dir`: å¸§æ•°æ®ä¿å­˜ç›®å½• (é»˜è®¤: å½“å‰ç›®å½•)

## â“ å¸¸è§é—®é¢˜

### Q1: è¿æ¥å¤±è´¥ "Connection refused"
**åŸå› **: ç½‘ç»œä¸é€šæˆ–æœåŠ¡å™¨æœªå¯åŠ¨
**è§£å†³**:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥: `ping 172.32.0.93`
2. ç¡®è®¤æœåŠ¡å™¨å·²å¯åŠ¨: åœ¨ Luckfox Pico ä¸Šè¿è¡Œ `./v4l2_usb`
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### Q2: å¸§ç‡å¾ˆä½æˆ–å¡é¡¿
**åŸå› **: ç½‘ç»œå¸¦å®½ä¸è¶³
**è§£å†³**:
1. ä½¿ç”¨åƒå…†ä»¥å¤ªç½‘
2. å‡å°‘ç½‘ç»œè´Ÿè½½
3. æ£€æŸ¥ç½‘ç»œè´¨é‡: `iperf3` æµ‹é€Ÿ

### Q3: "No such file or directory" é”™è¯¯
**åŸå› **: æ‘„åƒå¤´è®¾å¤‡æœªæ‰¾åˆ°
**è§£å†³**:
1. æ£€æŸ¥æ‘„åƒå¤´è¿æ¥: `ls /dev/video*`
2. ç¡®è®¤é©±åŠ¨åŠ è½½: `dmesg | grep -i video`
3. é‡æ–°æ’æ‹”æ‘„åƒå¤´

### Q4: ç¼–è¯‘é”™è¯¯
**è§£å†³**:
```bash
# ç¡®ä¿ä¾èµ–åº“å·²å®‰è£…
sudo apt update
sudo apt install build-essential cmake

# æ¸…ç†é‡æ–°ç¼–è¯‘
rm -rf build
mkdir build && cd build
cmake ..
make
```

### Q5: Windows ç¼–è¯‘é—®é¢˜
**è§£å†³**:
1. å®‰è£… MinGW-w64
2. ç¡®ä¿ `gcc` åœ¨ PATH ä¸­
3. ä½¿ç”¨ `build_windows.bat` è‡ªåŠ¨ç¼–è¯‘

### Q6: ç¨‹åºæ— æ³•æ­£å¸¸é€€å‡º
**è§£å†³**: ä½¿ç”¨ `Ctrl+C` å‘é€ SIGINT ä¿¡å·ï¼Œç¨‹åºä¼šä¼˜é›…é€€å‡ºå¹¶æ¸…ç†èµ„æº

## ğŸ” è°ƒè¯•ä¸ç›‘æ§

### æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
```bash
# æœåŠ¡å™¨ç«¯ä¼šæ˜¾ç¤º:
# - å®¢æˆ·ç«¯è¿æ¥çŠ¶æ€
# - å®æ—¶å¸§ç‡ç»Ÿè®¡
# - ç½‘ç»œä¼ è¾“é€Ÿåº¦

# å®¢æˆ·ç«¯ä¼šæ˜¾ç¤º:
# - æ¥æ”¶å¸§æ•°ç»Ÿè®¡
# - ä¿å­˜æ–‡ä»¶è·¯å¾„
# - ä¼ è¾“é€Ÿåº¦
```

### æ€§èƒ½ç›‘æ§
```bash
# ç½‘ç»œæµé‡ç›‘æ§
iftop -i eth0

# ç³»ç»Ÿèµ„æºç›‘æ§
htop

# ç£ç›˜ä½¿ç”¨ç›‘æ§ (å¦‚æœä¿å­˜æ–‡ä»¶)
df -h
```

## ğŸ“ˆ æŠ€æœ¯ç»†èŠ‚

### V4L2 å¤šå¹³é¢ API
- ä½¿ç”¨ `VIDIOC_S_FMT` è®¾ç½®å¤šå¹³é¢æ ¼å¼
- 256å­—èŠ‚å†…å­˜å¯¹é½ä¼˜åŒ–
- é›¶æ‹·è´å†…å­˜æ˜ å°„

### ç½‘ç»œä¼ è¾“ä¼˜åŒ–
- TCP åè®®ç¡®ä¿æ•°æ®å®Œæ•´æ€§
- å¤šçº¿ç¨‹å¼‚æ­¥ä¼ è¾“
- å®¢æˆ·ç«¯æ–­å¼€è‡ªåŠ¨é‡è¿

### ä¿¡å·å¤„ç†
- å®Œå–„çš„ SIGINT/SIGTERM å¤„ç†
- çº¿ç¨‹å®‰å…¨çš„é€€å‡ºæœºåˆ¶
- èµ„æºè‡ªåŠ¨æ¸…ç†

## ğŸ¤ è´¡çŒ®ä¸æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issue æˆ– Pull Requestã€‚

### å¼€å‘ç¯å¢ƒ
- **åµŒå…¥å¼**: Luckfox Pico SDK + GCC ARM äº¤å‰ç¼–è¯‘å™¨
- **Linux**: GCC + CMake
- **Windows**: MinGW-w64 + GCC

---

**ğŸ“ ç‰ˆæœ¬**: v1.0  
**ğŸ·ï¸ æ ‡ç­¾**: V4L2, RAW10, ç½‘ç»œæ¨æµ, åµŒå…¥å¼, è·¨å¹³å°  
**ğŸ“… æ›´æ–°**: 2025å¹´æœ€æ–°ç‰ˆæœ¬
